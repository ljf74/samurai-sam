var Qe=Object.defineProperty;var Je=(s,t,e)=>t in s?Qe(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>(Je(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();const Se=Math.PI,z=s=>s<0?-s:s,wt=(s,t)=>s<t?s:t,ye=(s,t)=>s>t?s:t,xt=s=>s<0?-1:1,ot=(s,t=0,e=1)=>s<t?t:s>e?e:s,Gt=(s,t=0,e=1)=>e-t?ot((s-t)/(e-t)):0,dt=(s,t=0,e=1)=>t+ot(s)*(e-t),ie=(s,t,e,n)=>z(s.x-e.x)*2<t.x+n.x&&z(s.y-e.y)*2<t.y+n.y,H=(s=1,t=0)=>t+(s-t)*Math.random(),Ve=(s=1)=>new k().setAngle(H(2*Se),s),o=(s=0,t)=>s.x==null?new k(s,t??s):new k(s.x,s.y);class k{constructor(t=0,e=0){this.x=t,this.y=e}copy(){return new k(this.x,this.y)}add(t){return new k(this.x+t.x,this.y+t.y)}subtract(t){return new k(this.x-t.x,this.y-t.y)}multiply(t){return new k(this.x*t.x,this.y*t.y)}divide(t){return new k(this.x/t.x,this.y/t.y)}scale(t){return new k(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new k(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(t),n=Math.sin(t);return new k(this.x*e-this.y*n,this.x*n+this.y*e)}direction(){return z(this.x)>z(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new k(this.y,-this.x)}floor(){return new k(Math.floor(this.x),Math.floor(this.y))}area(){return z(this.x*this.y)}lerp(t,e){return this.add(t.subtract(this).scale(ot(e)))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){}}let Ut=o(),Pt=32,re=o(1920,1200),d=o(),ts=1,es=1,ss=1,ns=1,is=0,rs=.8,ft=1,ht=0,me=.5,os=40,as=.7;class ls{constructor(t=o(),e=o(1),n=-1,i=1,r=0,l,c=0){this.pos=t.copy(),this.size=e,this.drawSize,this.tileIndex=n,this.tileSize=i,this.angle=r,this.color=l,this.additiveColor,this.mass=es,this.damping=ss,this.angleDamping=ns,this.elasticity=is,this.friction=rs,this.gravityScale=1,this.renderOrder=c,this.velocity=new k,this.angleVelocity=0,this.spawnTime=Rt,this.children=[],this.collideTiles=1,J.push(this)}update(){const t=this.parent;if(t){this.pos=this.localPos.multiply(o(t.getMirrorSign(),1)).rotate(-t.angle).add(t.pos),this.angle=t.getMirrorSign()*this.localAngle+t.angle;return}this.velocity.x=ot(this.velocity.x,-ft,ft),this.velocity.y=ot(this.velocity.y,-ft,ft);const e=this.pos.copy();if(this.velocity.y+=ht*this.gravityScale,this.pos.x+=this.velocity.x*=this.damping,this.pos.y+=this.velocity.y*=this.damping,this.angle+=this.angleVelocity*=this.angleDamping,!this.mass)return;const n=this.velocity.y<0;if(this.groundObject){const i=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=i+(this.velocity.x-i)*this.friction,this.groundObject=0}if(this.collideSolidObjects)for(const r of be){if(!this.isSolid&!r.isSolid||r.destroyed||r.parent||r==this||!ie(this.pos,this.size,r.pos,r.size)||!this.collideWithObject(r)|!r.collideWithObject(this))continue;if(ie(e,this.size,r.pos,r.size)){const p=e.subtract(r.pos),S=p.length(),v=.001,w=S<.01?Ve(v):p.scale(v/S);this.velocity=this.velocity.add(w),r.mass&&(r.velocity=r.velocity.subtract(w));continue}const l=this.size.add(r.size),c=(e.y-r.pos.y)*2>l.y+ht,h=z(e.y-r.pos.y)*2<l.y,g=z(e.x-r.pos.x)*2<l.x,u=ye(this.elasticity,r.elasticity);if(c|g|!h){if(this.pos.y=r.pos.y+(l.y/2+.001)*xt(e.y-r.pos.y),r.groundObject&&n||!r.mass)n&&(this.groundObject=r),this.velocity.y*=-u;else if(r.mass){const p=(this.mass*this.velocity.y+r.mass*r.velocity.y)/(this.mass+r.mass),S=this.velocity.y*(this.mass-r.mass)/(this.mass+r.mass)+r.velocity.y*2*r.mass/(this.mass+r.mass),v=r.velocity.y*(r.mass-this.mass)/(this.mass+r.mass)+this.velocity.y*2*this.mass/(this.mass+r.mass);this.velocity.y=dt(u,p,S),r.velocity.y=dt(u,p,v)}}if(!c&h)if(this.pos.x=r.pos.x+(l.x/2+.001)*xt(e.x-r.pos.x),r.mass){const p=(this.mass*this.velocity.x+r.mass*r.velocity.x)/(this.mass+r.mass),S=this.velocity.x*(this.mass-r.mass)/(this.mass+r.mass)+r.velocity.x*2*r.mass/(this.mass+r.mass),v=r.velocity.x*(r.mass-this.mass)/(this.mass+r.mass)+this.velocity.x*2*this.mass/(this.mass+r.mass);this.velocity.x=dt(u,p,S),r.velocity.x=dt(u,p,v)}else this.velocity.x*=-u}}render(){}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.destroy(t.parent=0)}}collideWithObject(t){return 1}getAliveTime(){return Rt-this.spawnTime}applyAcceleration(t){this.mass&&(this.velocity=this.velocity.add(t))}applyForce(t){this.applyAcceleration(t.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(t,e=o(),n=0){this.children.push(t),t.parent=this,t.localPos=e.copy(),t.localAngle=n}removeChild(t){this.children.splice(this.children.indexOf(t),1),t.parent=0}toString(){}}let b,Tt,Q,E,Mt=o();const cs=s=>s.add(o(.5)).subtract(Mt.scale(.5)).multiply(o(1/Pt,-1/Pt)).add(Ut),hs=s=>s.subtract(Ut).multiply(o(Pt,-Pt)).add(Mt.scale(.5)).subtract(o(.5)),us=(s,t=0)=>$[t]&&$[t][s]&1,ds=()=>$=[[]],pe=us;o();let $t=o(),$=[[]];function fs(){we||document.hasFocus()||ds(),cs($t)}function gs(){for(const s of $)for(const t in s)s[t]&=1}onkeydown=s=>{s.repeat||($[0][ve(s.which)]=3)};onkeyup=s=>{$[0][ve(s.which)]=4};const ve=s=>s==87?38:s==83?40:s==65?37:s==68?39:s;onmousedown=s=>{$[0][s.button]=3,onmousemove(s),s.button&&s.preventDefault()};onmouseup=s=>$[0][s.button]=$[0][s.button]&2|4;onmousemove=s=>$t=Ss(s);onwheel=s=>s.ctrlKey||xt(s.deltaY);oncontextmenu=s=>!1;const Ss=s=>{if(!b)return o();const t=b.getBoundingClientRect();return o(b.width,b.height).multiply(o(Gt(s.x,t.left,t.right),Gt(s.y,t.top,t.bottom)))},we=window.ontouchstart!==void 0;if(we){let s,t=onmousedown,e=onmouseup;onmousedown=onmouseup=()=>0,ontouchstart=n=>(ys(0),ontouchstart=ontouchmove=ontouchend=i=>{i.button=0;const r=i.touches.length;return r?(i.x=i.touches[0].clientX,i.y=i.touches[0].clientY,s?onmousemove(i):t(i)):s&&e(i),s=r,!0},ontouchstart(n))}class at{constructor(t,e=os,n=as){this.range=e,this.taper=n,this.randomness=t[1]||0,t[1]=0,this.cachedSamples=Zt(...t)}play(t,e=1,n=1,i=1){let r;if(t){const c=this.range;if(c){const h=Ut.distanceSquared(t);if(h>c*c)return;e*=Gt(h**.5,c,c*this.taper)}r=hs(t).x*2/b.width-1}const l=n+n*this.randomness*i*H(-1,1);return Kt([this.cachedSamples],e,l,r)}playNote(t,e,n){return this.play(e,n,2**(t/12),0)}}class oe{constructor(t){this.cachedSamples=ms(...t)}play(t,e=1){return this.source=Kt(this.cachedSamples,t,1,0,e)}stop(){this.source&&this.source.stop(),this.source=0}isPlaying(){return this.source}}let R;function Kt(s,t=1,e=1,n=0,i=0){if(R||(R=new AudioContext),R.resume(),R.state!="running")return;const r=R.createBuffer(s.length,s[0].length,N),l=R.createBufferSource();s.forEach((h,g)=>r.getChannelData(g).set(h)),l.buffer=r,l.playbackRate.value=e,l.loop=i;const c=R.createGain();return c.gain.value=me*t,c.connect(R.destination),l.connect(new StereoPannerNode(R,{pan:ot(n,-1,1)})).connect(c),l.start(),l}const ys=(...s)=>Kt([Zt(...s)]),N=44100;function Zt(s=1,t=.05,e=220,n=0,i=0,r=.1,l=0,c=1,h=0,g=0,u=0,p=0,S=0,v=0,w=0,D=0,P=0,O=1,W=0,tt=0){let I=Se*2,lt=h*=500*I/N/N,Y=[],et=e*=(1+t*H(-1,1))*I/N,F=0,ut=0,x=0,K=1,kt=0,Ye=0,Z=0,It,st;for(n=n*N+9,W*=N,i*=N,r*=N,P*=N,g*=500*I/N**3,w*=I/N,u*=I/N,p*=N,S=S*N|0,st=n+W+i+r+P|0;x<st;Y[x++]=Z)++Ye%(D*100|0)||(Z=l?l>1?l>2?l>3?Math.sin((F%I)**3):ye(wt(Math.tan(F),1),-1):1-(2*F/I%2+2)%2:1-4*z(Math.round(F/I)-F/I):Math.sin(F),Z=(S?1-tt+tt*Math.sin(I*x/S):1)*xt(Z)*z(Z)**c*s*me*(x<n?x/n:x<n+W?1-(x-n)/W*(1-O):x<n+W+i?O:x<st-P?(st-x-P)/r*O:0),Z=P?Z/2+(P>x?0:(x<st-P?1:(st-x)/P)*Y[x-P|0]/2):Z),It=(e+=h+=g)*Math.cos(w*ut++),F+=It-It*v*(1-(Math.sin(x)+1)*1e9%2),K&&++K>p&&(e+=u,et+=u,K=0),S&&!(++kt%S)&&(e=et,h=lt,K||(K=1));return Y}function ms(s,t,e,n=125){let i,r,l,c,h,g,u,p,S,v,w,D,P,O=0,W,tt=[],I=[],lt=[],Y=0,et=0,F=1,ut={},x=N/n*60>>2;for(;F;Y++)tt=[F=p=D=0],e.forEach((K,kt)=>{for(u=t[K][Y]||[0,0,0],F|=!!t[K][Y],W=D+(t[K][0].length-2-!p)*x,P=kt==e.length-1,i=2,l=D;i<u.length+P;p=++i){for(h=u[i],S=i==u.length+P-1&&P||v!=(u[0]||0)|h|0,r=0;r<x&&p;r++>x-99&&S?w+=(w<1)/99:0)g=(1-w)*tt[O++]/2||0,I[l]=(I[l]||0)-g*et+g,lt[l]=(lt[l++]||0)+g*et+g;h&&(w=h%1,et=u[1]||0,(h|=0)&&(tt=ut[[v=u[O=0]||0,h]]=ut[[v,h]]||(c=[...s[v]],c[2]*=2**((h-12)/12),h>0?Zt(...c):[])))}D=W});return[I,lt]}const Xt=60,B=1/Xt;let J=[],be=[],ps=0,Rt=0,vs=0,Ce=1;function xe(){return Ce}function Dt(s){Ce=s}function ws(s,t,e,n,i){const r="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none";document.body.style=r,document.body.appendChild(b=document.createElement("canvas")),Tt=b.getContext("2d"),document.body.appendChild(Q=document.createElement("canvas")),E=Q.getContext("2d");const l="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";b.style=b.style=Q.style=l;let c=0,h;s(),g();function g(u=0){let p=u-c;if(c=u,h+=!vs*p,h=wt(h,50),d.x){b.width=d.x,b.height=d.y;const S=innerWidth/innerHeight,v=b.width/b.height;b.style.width=b.style.width=Q.style.width=S<v?"100%":"",b.style.height=b.style.height=Q.style.height=S<v?"":"100%"}else b.width=wt(innerWidth,re.x),b.height=wt(innerHeight,re.y);Q.width=b.width,Q.height=b.height,Mt=o(b.width,b.height);{let S=0;for(h<0&&h>-9&&(S=h,h=0);h>=0;h-=1e3/Xt)fs(),t(),Cs(),e(),gs();h+=S}bs(),n(),J.sort((S,v)=>S.renderOrder-v.renderOrder);for(const S of J)S.destroyed||S.render();i(),requestAnimationFrame(g)}}function bs(){Mt=o(b.width,b.height),Tt.imageSmoothingEnabled=!ts}function Cs(){be=J.filter(t=>t.collideSolidObjects);const s=t=>{if(!t.destroyed){t.update();for(const e of t.children)s(e)}};for(const t of J)t.parent||s(t);J=J.filter(t=>!t.destroyed),Rt=++ps/Xt}const xs=s=>d=s,Ps=s=>ht=s,y="#EE2B16",Es="#2B1E1E",Ts="#FF5E19",Ms="#141414",Bs="#171717",qt="#3765CA",Ns="#1E202B",ks="#22B5FF",rt="#0096C8",Ot="#F6AC43",Is="#FCA5EB",V="#FF7ADF",Ds=[.07,,243,.1,.1,.7,,1.16,-1.6,.3,,,.04,,,.1,,.99,.09,.06],Os=[.6,,140,.05,.29,.33,1,1.6,,,,,.16,,,,.04,.66,.13],As=[2,,1573,.01,.01,.01,1,.7,,30,,,.01,,.7,,.03,.4,.02,.02],Fs=[2,,433,.01,.15,.48,3,3.1,,,,,,1.6,,.2,.23,.41,.01],Ls=[,,140,,.02,.04,3,.09,-3,-8,,,,2,,.2,,.6,.02,.04],gt=[,,225,.04,.1,.1,,,18,3.6,,,,1.8,,,,.9,.01];function Ws(){return gt[1]=Math.random()/5,gt[2]=Math.random()*600,gt[4]=Math.random()/10,gt}const Pe=[.2,,1619,.01,.02,.01,4,.39,,15,,,.01,,1.4,.1,,.3,.01],js=[.7,0,124,,.03,.55,2,,,,,,,,,,,.36,.01,.36],Gs=[.2,0,229,,.05,.19,3,,.5,2.1,,,.27,7.5,,.1,.02,1.03,,.03],Rs=[.3,0,122,.02,.54,.4,1,.17,,,,,,.4,,,,.28,.11],qs=[[Pe],[[[,,24,24,24,,25,13,13,,]]],[0],,{}],Hs=[[js,Gs,Rs,Pe],[[[,,29,,,,24,,,,29,,,,24,,,,31,,,,25,,,,24,,,,,,,,29,,,,24,,,,29,,,,24,,,,31,,,,24,,,,19,,,,,,,,]],[[,,29,,,,24,,,,31,,,,24,,,,32,,,,24,,,,31,,,,24,,,,29,,,,24,,,,31,,,,29,,,,25,,,,,,,,,,,,,,,,]],[[,,24,,,,24,,,,24,,,,25,,,,24,,,,24,,20,,19,,,,,,,,]],[[,,29,,,,24,,,,31,,,,24,,,,32,,,,24,,,,31,,,,24,,,,25,,,,29,,,,31,,,,32,,,,31,,32,,31,,32,,31,,32,,31,,32,,31,32,31,32,31,32,31,32,31,,,,,,,,],[1,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25,25,25,,27,27,27,,]],[[2,-1,17,,20,,27,,24,,17,,20,,27,,20,,15,,20,,24,,20,,15,,20,,24,,20,,13,,20,,24,,20,,13,,20,,24,,20,,12,,20,,24,,20,,12,,20,,24,,20,,],[,1,29,,,,24,,,,29,,,,24,,,,31,,,,25,,,,24,,,,,,,,29,,,,24,,,,29,,,,24,,,,31,,,,24,,,,19,,,,,,,,],[3,-.2,25,25,25,30,24,25,25,30,22,25,25,30,24,25,25,30,22,25,25,30,20,25,25,30,22,25,25,30,,,,,22,24,24,26,22,25,25,26,13,15,15,16,12,15,15,16,12,13,13,16,13,17,17,16,,,,,,,,,]],[[2,-1,5,,17,,24,,17,,5,,17,,24,,17,,8,,15,,24,,15,,8,,15,,24,,15,,13,,15,,20,,15,,13,,15,,20,,15,,12,,24,,12,,24,,12,,24,,12,,,,],[,1,29,,,,24,,,,31,,,,24,,,,32,,,,24,,,,31,,,,24,,,,29,,,,24,,,,31,,,,29,,,,25,,,,,,,,,,,,,,,,],[3,-.2,25,25,25,30,24,25,25,30,22,25,25,30,24,25,25,30,22,25,25,30,20,25,25,30,22,25,25,30,,,,,22,24,24,26,22,25,25,26,13,15,15,16,12,15,15,16,12,13,13,16,13,17,17,16,,,,,,,,,]],[[2,-1,5,,17,,24,,17,,5,,17,,24,,17,,8,,15,,24,,15,,8,,15,,24,,15,,13,,15,,20,,15,,13,,15,,20,,15,,12,,24,,12,,24,,12,,24,,12,,24,,12,,,,,,,,,,,,,,,,10,10,8,8,5,1,7,7],[,1,29,,,,24,,,,31,,,,24,,,,32,,,,24,,,,31,,,,24,,,,29,,,,24,,,,31,,,,29,,,,25,25,25,,29,29,29,,31,31,31,,34,34,34,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,,,,,,],[3,-.2,25,25,25,30,24,25,25,30,22,25,25,30,24,25,25,30,22,25,25,30,20,25,25,30,22,25,25,30,,,,,22,24,24,26,22,25,25,26,13,15,15,16,12,15,15,16,12,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,21,,21,,21,,21],[1,.2,18,,,,22,,,,17,,,,22,,,,15,,,,21,,,,12,,,,19,,,,12,,,,19,,,,16,,,,26,,,,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,21,21,21,,27,27,27,,]]],[0,1,2,3,4,5,4,6,4,4,5,4,6,4,4,5,4,6,4,4,5,4,6,4,4,5,4,6,4,4,5,4,6,4,4,5,4,6,4,4,5,4,6,4,4,5,4,6,4],120,{}];let _s=0;function _(){return++_s}function zs(s){const t=[];for(let e=0;e<s.length;e++){let n;if(s[e]=="M")n=At(s.substring(e+1,s.length),"M");else if(s[e]=="C")n=At(s.substring(e+1,s.length),"C");else if(s[e]=="Z")n=At(s.substring(e,s.length),"Z");else continue;t.push(n)}return t}function At(s,t){const e=s.match(/^(.*?)[a-zA-Z]/);if(!e||e.length<2)return;const n=e[1],i=$s(n,t);return{id:_(),code:t,command:Us(t),...i}}function Us(s){switch(s){case"M":return"moveto";case"C":return"curveto";case"Z":return"closepath"}}function $s(s,t){const e={x:NaN,y:NaN,x1:NaN,y1:NaN,x2:NaN,y2:NaN},n=s.split(" ");switch(t){case"M":e.x=parseFloat(n[0].split(",")[0]),e.y=parseFloat(n[0].split(",")[1]);break;case"C":e.x=parseFloat(n[2].split(",")[0]),e.y=parseFloat(n[2].split(",")[1]),e.x2=parseFloat(n[1].split(",")[0]),e.y2=parseFloat(n[1].split(",")[1]),e.x1=parseFloat(n[0].split(",")[0]),e.y1=parseFloat(n[0].split(",")[1]);break}return e}function Ks(s){var t,e={x:0,y:0},n={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return s.forEach(function(i){i.command==="moveto"&&(t=i),i.x0=e.x,i.y0=e.y;for(var r in n)r in i&&(i[r]+=i.relative?i[n[r]]:0);"x"in i||(i.x=e.x),"y"in i||(i.y=e.y),i.relative=!1,i.code=i.code.toUpperCase(),i.command=="closepath"&&t&&(i.x=t.x,i.y=t.y),e=i}),s}function X(s,t){s.forEach(e=>{const{x0:n,y0:i,x1:r,y1:l,x2:c,y2:h,x:g,y:u}=e;Number.isNaN(n)||(e.x0+=t.x),Number.isNaN(i)||(e.y0+=t.y),Number.isNaN(r)||(e.x1+=t.x),Number.isNaN(l)||(e.y1+=t.y),Number.isNaN(c)||(e.x2+=t.x),Number.isNaN(h)||(e.y2+=t.y),Number.isNaN(g)||(e.x+=t.x),Number.isNaN(u)||(e.y+=t.y)})}function Et(s,t,e,n,i,r,l,c,h){const g=o(s+(e-s)*h,t+(n-t)*h),u=o(e+(i-e)*h,n+(r-n)*h),p=o(i+(l-i)*h,r+(c-r)*h),S=o(g.x+(u.x-g.x)*h,g.y+(u.y-g.y)*h),v=o(u.x+(p.x-u.x)*h,u.y+(p.y-u.y)*h),w=o(S.x+(v.x-S.x)*h,S.y+(v.y-S.y)*h);return{r0:g,r1:u,r2:p,s0:S,s1:v,t0:w}}function Zs(s,t,e,n,i,r,l,c,h){const{r0:g,r2:u,s0:p,s1:S,t0:v}=Et(s,t,e,n,i,r,l,c,h),w={id:_(),x0:s,y0:t,x1:g.x,y1:g.y,x2:p.x,y2:p.y,x:v.x,y:v.y},D={id:_(),x0:v.x,y0:v.y,x1:S.x,y1:S.y,x2:u.x,y2:u.y,x:l,y:c};return[w,D]}function Ht(s,t){let e=1,n=99999;for(let r=0;r<.99;r=r+.05){const l=Et(s.x0,s.y0,s.x1,s.y1,s.x2,s.y2,s.x,s.y,r),c=Math.abs(l.t0.x-t.x)+Math.abs(l.t0.y-t.y);c<n&&(n=c,e=r)}const i=Zs(s.x0,s.y0,s.x1,s.y1,s.x2,s.y2,s.x,s.y,e);return i.forEach(r=>{r.code=s.code,r.command=s.command,r.id=_()}),i}function Xs(s,t){if(!s||!t)return[];const e=new f(null,s.cmds,null,"orange",s.pos.copy().add(o(0,0)),s.velocity.copy(),s.size.copy(),s.getGravityScale());e.setGravityScale(5),e.velocity.x=-1;const n=new f(null,s.cmds,null,"gray",s.pos.copy().add(o(0,0),s.velocity.copy(),s.size.copy(),s.getGravityScale()));n.setGravityScale(10),n.velocity.x=1;let i=-1;const r=s.cmds.find((l,c)=>(i=c,l.id==t.id));if(r){if(r.code=="C"){const l=Ht(r,t.intersectionPoint);l[1].isIntersectionPoint=!0;const c=Ht(r,t.intersectionPoint);c[1].isIntersectionPoint=!0,X(l,s.pos.copy().multiply(o(-1,-1))),X(c,s.pos.copy().multiply(o(-1,-1))),e.addCmds(i,1,l),n.addCmds(i,1,c)}return[e,n]}}function Ys(s){const t=s[0],e=t.cmds.findIndex(w=>w.isIntersectionPoint),n={id:_(),x:t.cmds[e].x0,y:t.cmds[e].y0,code:"M",command:"moveto"},i=[n];i.push({...t.cmds[e]});let r=(e+1)%t.cmds.length;for(r;r<t.cmds.length;r++){const w={...t.cmds[r]};if(w.isIntersectionPoint)break;i.push(w)}const l={id:_(),x:n.x,y:n.y,code:"Z",command:"closepath"};i.push(l),s[0].setCmds(i);const c=s[1];let h=-1;for(let w=c.cmds.length-1;w>=0;w--)if(c.cmds[w].isIntersectionPoint){h=w;break}const g={id:_(),x:c.cmds[h].x0,y:c.cmds[h].y0,code:"M",command:"moveto"},u=[g];u.push({...c.cmds[h]});let p=!1,S=h;for(;!p;){S=(S+1)%c.cmds.length;const w={...c.cmds[S]};if(w.code=="C"){if(w.isIntersectionPoint){p=!0;break}u.push(w)}}const v={id:_(),x:g.x,y:g.y,code:"Z",command:"closepath"};u.push(v),s[1].setCmds(u)}function Qs(s){s.forEach(t=>{t.id||(t.id=_())})}function Js(s,t,e=o(0,0)){const n=Math.PI/180*t,i=Math.cos(n),r=Math.sin(n),l=e.x,c=e.y,h=(u,p)=>{const S=u-l,v=p-c;return S*i-v*r+l},g=(u,p)=>{const S=u-l,v=p-c;return S*r+v*i+c};s.forEach(u=>{const{x0:p,y0:S,x1:v,y1:w,x2:D,y2:P,x:O,y:W}=u;Number.isNaN(p)||(u.x0=h(u.x0,u.y0)),Number.isNaN(S)||(u.y0=g(u.x0,u.y0)),Number.isNaN(v)||(u.x1=h(u.x1,u.y1)),Number.isNaN(w)||(u.y1=g(u.x1,u.y1)),Number.isNaN(D)||(u.x2=h(u.x2,u.y2)),Number.isNaN(P)||(u.y2=g(u.x2,u.y2)),Number.isNaN(O)||(u.x=h(u.x,u.y)),Number.isNaN(W)||(u.y=g(u.x,u.y))})}const Vs=new CustomEvent("tick",{detail:{data:{}}}),tn=new CustomEvent("play",{detail:{data:{}}}),en=new CustomEvent("split",{detail:{data:{}}}),sn=new CustomEvent("wave",{detail:{data:{}}}),nn=new CustomEvent("web3",{detail:{data:{}}}),rn=new CustomEvent("killed",{detail:{data:{}}}),on=new CustomEvent("toslice",{detail:{data:{}}});function A(s,t){const e=an(s);e.detail.data=t,window.dispatchEvent(e)}function T(s,t){window.addEventListener(s,t)}function U(s,t){window.removeEventListener(s,t)}function an(s){switch(s){case"tick":return Vs;case"split":return en;case"play":return tn;case"wave":return sn;case"web3":return nn;case"killed":return rn;case"toslice":return on}}function ln(s,t){s.forEach(e=>{const{x0:n,y0:i,x1:r,y1:l,x2:c,y2:h,x:g,y:u}=e;Number.isNaN(n)||(e.x0*=t.x),Number.isNaN(i)||(e.y0*=t.y),Number.isNaN(r)||(e.x1*=t.x),Number.isNaN(l)||(e.y1*=t.y),Number.isNaN(c)||(e.x2*=t.x),Number.isNaN(h)||(e.y2*=t.y),Number.isNaN(g)||(e.x*=t.x),Number.isNaN(u)||(e.y*=t.y)})}class f extends ls{constructor(e,n,i,r,l=o(0,0),c=o(0,0),h=o(1,1),g=1){super(l,h);a(this,"path");a(this,"fill");a(this,"pos");a(this,"velocity");a(this,"size");a(this,"cmds");a(this,"current2DPath",{});a(this,"intersectionPoints",[]);a(this,"children",[]);a(this,"sliceColor",null);a(this,"gameObjectType","");a(this,"killedTime",0);a(this,"sliceSound");a(this,"centerPos",o(0,0));a(this,"gravitationScale",1);this.size=h,this.pos=l,this.path=e,this.sliceColor=i,this.fill=r,this.velocity=c,this.gravitationScale=g,this.centerPos=l.copy(),this.sliceSound=new at(Ws(),0),this.path?(this.cmds=zs(e),Ks(this.cmds),X(this.cmds,this.pos)):n&&(this.cmds=[...n]),Qs(this.cmds),this.current2DPath.path2D=new Path2D(this.getCmdsAsPathString()),this.current2DPath.path=this.getCmdsAsPathString()}setGameObjectType(e){this.gameObjectType=e}debugCenterPoint(e){e.save(),e.fillStyle="green";const n=this.centerPos.x+this.pos.x,i=this.centerPos.y+this.pos.y;e.moveTo(n,i),e.arc(n,i,5,0,2*Math.PI),e.fill(),e.restore()}rotateSvg(e,n=o(0,0)){Js(this.cmds,e,n),this.current2DPath.path2D=new Path2D(this.getCmdsAsPathString()),this.current2DPath.path=this.getCmdsAsPathString()}translateSvg(e){const n=e.copy().add(this.pos);this.centerPos.x=n.x,this.centerPos.y=n.y,X(this.cmds,n),this.current2DPath.path2D=new Path2D(this.getCmdsAsPathString()),this.current2DPath.path=this.getCmdsAsPathString()}setPos(e){const n=e.copy().subtract(this.pos);X(this.cmds,n),this.pos.x=e.x,this.pos.y=e.y}getCenterPos(){const e=this.centerPos.x+this.pos.x,n=this.centerPos.y+this.pos.y;return o(e,n)}update(e=o(0,0)){if(this.isCut()){this.killedTime+=B;return}const n=o(this.pos.x,this.pos.y);this.velocity.y+=ht*this.gravitationScale*xe(),this.pos.x+=this.velocity.x,this.pos.y+=this.velocity.y,this.pos.y+=e.y,this.pos.x+=e.x,X(this.cmds,n.subtract(this.pos)),this.current2DPath.path2D=new Path2D(this.getCmdsAsPathString()),this.current2DPath.path=this.getCmdsAsPathString()}render(e){if(e){if(this.children.length){this.children.forEach(n=>n.render(e));return}e.save(),e.lineWidth=5,e.beginPath(),e.fillStyle=this.fill||"blue",e.fill(this.current2DPath.path2D),e.restore()}}debugIntersectionPoints(e){e.save(),e.fillStyle="green",this.getIntersectionPoints().forEach(({intersectionPoint:n})=>{const i=n.x,r=n.y;e.moveTo(i,r),e.arc(i,r,5,0,2*Math.PI),e.fill()}),e.restore()}addCmds(e,n,i){X(i,this.pos),this.cmds.splice(e,n,...i),this.current2DPath.path2D=new Path2D(this.getCmdsAsPathString()),this.current2DPath.path=this.getCmdsAsPathString()}getIntersectionPoints(){return this.intersectionPoints}addIntersectionPoint(e){if(this.intersectionPoints.push(e),this.intersectionPoints.length==1){const n=new f(null,this.cmds,this.sliceColor,"yellow",this.pos.copy(),this.velocity.copy(),this.size.copy(),this.gravitationScale),i=this.intersectionPoints[0];let r=-1;const l=this.cmds.find((c,h)=>(r=h,c.id==i.id));if(!l)return;if(l.code=="C"){const c=Ht(l,i.intersectionPoint);c[1].isIntersectionPoint=!0,X(c,n.pos.copy().multiply(o(-1,-1))),n.addCmds(r,1,c),this.setCmds(n.cmds)}}if(this.intersectionPoints.length==2){const n=Xs(this,this.intersectionPoints[1]);n&&n.length&&!this.children.length&&(Ys(n),n.forEach(i=>{this.children.push(i)}),this.sliceSound.play(),A("split",{svg:this,intersectionPoint:this.intersectionPoints[1].intersectionPoint}))}}getCmdsAsPathString(){let e="";return this.cmds.forEach(n=>{switch(n.code){case"M":e+=`M${n.x},${n.y}`;break;case"C":e+=`C${n.x1},${n.y1} ${n.x2},${n.y2} ${n.x},${n.y}`;break;case"Z":e+="Z";break}}),e}setGravityScale(e){this.gravitationScale=e}getGravityScale(){return this.gravitationScale}setCmds(e){this.cmds=e,this.current2DPath.path2D=new Path2D(this.getCmdsAsPathString()),this.current2DPath.path=this.getCmdsAsPathString()}isCut(){return this.children.length>0}setScale(e){e&&!e.x&&(e=o(e,e)),ln(this.cmds,e),this.current2DPath.path2D=new Path2D(this.getCmdsAsPathString()),this.current2DPath.path=this.getCmdsAsPathString()}addChild(e){this.children.push(e)}}function cn(s,t,e,n){const i=(t.x-s.x)*(n.y-e.y)-(t.y-s.y)*(n.x-e.x);if(i==0)return null;const r=((e.x-s.x)*(n.y-e.y)-(e.y-s.y)*(n.x-e.x))/i,l=((e.x-s.x)*(t.y-s.y)-(e.y-s.y)*(t.x-s.x))/i;if(r<0||r>1||l<0||l>1)return null;const c=s.x+r*(t.x-s.x),h=s.y+r*(t.y-s.y);return Number.isNaN(c)||Number.isNaN(h)?null:o(e.x,e.y)}function hn(s,t,e=10){let n=!1;for(let i of s)if(Math.abs(i.intersectionPoint.x-t.intersectionPoint.x)<=e&&Math.abs(i.intersectionPoint.y-t.intersectionPoint.y)<=e&&(n=!0),n)break;return n}function un(s,t,e=10){let n=!1;for(let i of s)if(Math.abs(i.intersectionPoint.x-t.x)<=e&&Math.abs(i.intersectionPoint.y-t.y)<=e&&(n=!0),n)break;return n}function dn(s){const t=[];return s.cmds.forEach(e=>{if(e.code==="C"){const{x0:n,y0:i,x1:r,y1:l,x2:c,y2:h,x:g,y:u}=e;for(let p=0;p<.99;p=p+.05){const S=Et(n,i,r,l,c,h,g,u,p),v=Et(n,i,r,l,c,h,g,u,p+.05);for(let w=0;w<M.length-1;w++){if(M[w+1].draws<=ke-1)continue;const D=M[w],P=M[w+1],O=cn(D,P,S.t0,v.t0);O&&(un(t,O)||t.push({id:e.id,intersectionPoint:O}))}}}}),t}function C(s,t=10){dn(s).forEach(n=>{hn(s.intersectionPoints,n,t)||s.addIntersectionPoint(n)})}class Yt{constructor(t){a(this,"handleSvg");a(this,"swordPart1Svg");a(this,"collection");this.collection=t,t.metadata.attributes.forEach(e=>{switch(e.trait_type){case"Handle":this.handleSvg=new f(e.value,null,null,"white"),this.handleSvg.setGravityScale(0),this.handleSvg.translateSvg(o(-20,94));break;case"Sword part1":this.swordPart1Svg=new f(e.value,null,null,rt),this.swordPart1Svg.setGravityScale(0);break}}),this.getSvgs().forEach(e=>{e.setPos(o(400,300))})}update(){this.getSvgs().forEach(t=>{t.update(),C(t,1)})}render(t){this.getSvgs().forEach(e=>e.render(t))}getSvgs(){const t=[];return this.swordPart1Svg&&t.push(this.swordPart1Svg),this.handleSvg&&t.push(this.handleSvg),t}setScale(t){this.getSvgs().forEach(e=>{e.setScale(t)})}setPos(t){this.getSvgs().forEach(e=>{e.setPos(t)})}translate(t){this.getSvgs().forEach(e=>{e.translateSvg(t)})}getCollection(){return this.collection}}class Qt{constructor(t){a(this,"handleSvg");a(this,"swordPart1Svg");a(this,"swordPart2Svg");a(this,"collection");this.collection=t,t.metadata.attributes.forEach(e=>{switch(e.trait_type){case"Handle":this.handleSvg=new f(e.value,null,null,"white"),this.handleSvg.setGravityScale(0),this.handleSvg.translateSvg(o(2,128));break;case"Sword part1":this.swordPart1Svg=new f(e.value,null,null,V),this.swordPart1Svg.setGravityScale(0);break;case"Sword part2":this.swordPart2Svg=new f(e.value,null,null,V),this.swordPart2Svg.setGravityScale(0),this.swordPart2Svg.translateSvg(o(40,3));break}}),this.getSvgs().forEach(e=>{e.setPos(o(150,300))})}update(){this.getSvgs().forEach(t=>{t.update(),C(t,2)})}render(t){this.getSvgs().forEach(e=>e.render(t))}getSvgs(){const t=[];return this.swordPart1Svg&&t.push(this.swordPart1Svg),this.swordPart2Svg&&t.push(this.swordPart2Svg),this.handleSvg&&t.push(this.handleSvg),t}getCollection(){return this.collection}setScale(t){this.getSvgs().forEach(e=>{e.setScale(t)})}setPos(t){this.getSvgs().forEach(e=>{e.setPos(t)})}translate(t){this.getSvgs().forEach(e=>{e.translateSvg(t)})}}const fn="x.paras.near";let Ee="";function gn(){return{networkId:"mainnet",keyStore:Ee,nodeUrl:"https://rpc.mainnet.near.org",contractName:fn,appName:"Paras Testnet",walletUrl:"https://wallet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org"}}function Sn(s){Ee=s}const Jt="497912",Vt="497913",bt={name:"light-saber",isOwned:!1,token_series_id:Jt,priceInYoctoNear:"150000000000000000000000",nearPrice:"0.1"},Ct={name:"light-saber",isOwned:!1,token_series_id:Vt,priceInYoctoNear:"150000000000000000000000",nearPrice:"0.1"};class yn{constructor(){a(this,"walletConnection");a(this,"contract");a(this,"accountId");a(this,"userName");a(this,"ready");a(this,"nearConfig",gn());a(this,"resolveContract");a(this,"getAccountId",()=>this.walletConnection.getAccountId());a(this,"getNftTokensForOwner",t=>(t||(t=this.getAccountId()),this.contract.nft_tokens_for_owner({account_id:t})));this.ready=new Promise(t=>{this.resolveContract=t})}isSignedIn(){return this&&this.walletConnection&&this.walletConnection.isSignedIn()}async initContract(){const t=window.nearApi,e=new t.keyStores.BrowserLocalStorageKeyStore,n=await t.connect({...this.nearConfig,keyStore:e});return this.walletConnection=new t.WalletConnection(n,"sam"),this.accountId=this.walletConnection.getAccountId(),this.contract=await new t.Contract(this.walletConnection.account(),this.nearConfig.contractName,{viewMethods:["nft_tokens_for_owner"],changeMethods:["nft_buy"]}),this.resolveContract(),this.walletConnection}logout(){this.walletConnection.signOut()}login(){this.walletConnection.requestSignIn(this.nearConfig.contractName)}nftBuy({token_series_id:t,priceInYoctoNear:e}){return this.contract.nft_buy({owner_id:this.getAccountId(),receiver_id:this.getAccountId(),token_series_id:t},"300000000000000",e)}}function mn(s){return new Promise(t=>{window.nearApi&&t("");const e=document.createElement("script");e.onload=()=>{const n=window.nearApi,i=new n.keyStores.BrowserLocalStorageKeyStore;Sn(i),t("")},e.src=s,document.head.appendChild(e)})}const pn="https://js13kgames.com/src/near-api-js.js",vn="https://js13kgames2023.netlify.app/.netlify/functions/collection";let St,yt,G,Te,Me;function wn(s){s.forEach(t=>{const e=t.token_id||"";if(e.split(":")[0])switch(e.split(":")[0]){case Vt:Ct.isOwned=!0;break;case Jt:bt.isOwned=!0;break}})}function bn(){return mn(pn).then(()=>(G=new yn,G.initContract()))}function Cn(){return new Promise(async s=>{St||(St=await G.getNftTokensForOwner(),wn(St)),s(St)})}function xn(){return new Promise(async s=>{yt||(yt=await Pn(),yt.forEach(t=>{switch(t.token_series_id){case Jt:Te=new Yt(t);break;case Vt:Me=new Qt(t);break}})),s(yt)})}function mt(s){return s.isOwned}function ae(s){G.nftBuy(s)}function Ft(){if(!G)return!1;if(!G.isSignedIn())return G.login()}function Lt(){return!!G}function q(){return G?G.isSignedIn():!1}function Pn(){let s=vn;return window.location.hostname.match("localhost")&&(s="/api"),fetch(s).then(t=>t.json()).then(t=>t.data.results.filter(e=>e.metadata.copies>0&&!e.is_non_mintable))}function Be(){return Me}function Ne(){return Te}const M=[],ke=6;let Ie="white",De="white",Bt=!1,En=new at(Ds),Tn=new at(Os),Oe,Ae,nt=null,it=null,Fe=null,Le=null;function Mn(){for(let s=M.length-1;s>=0;s--)M[s].draws<=0&&M.splice(s,1)}function Bn(){return Bt?Ie:De}function Nn(){return Bt?Oe:Ae}function kn(){return Bt?Le:Fe}function In(s){if(!M.length)return;pe(0)||M[0].draws--,s.strokeStyle=Bn();const t=kn();if(t){const n=M[M.length-1];n&&(t.setPos(o(n.x,n.y)),t.render(s))}const e=Nn();e&&e.play();for(let n=0;n<M.length-1;n++){const i=M[n],r=M[n+1];i.draws>0&&r.draws>0&&(s.lineWidth=i.draws*2,s.beginPath(),s.moveTo(i.x,i.y),s.lineTo(r.x,r.y),s.stroke()),i.draws--}Mn()}function Dn(){if(!pe(0))return;const s=$t;M.splice(M.length,0,{x:s.x,y:s.y,draws:ke})}function le(s){Bt=s}function pt(s){Ie=s,Oe=je(s),Le=We(s)}function ce(s){De=s,Ae=je(s),Fe=We(s)}function We(s){if(s==V){if(!it){const t=Be();it=new Qt(t.getCollection()),it.setPos(o(0,0)),it.translate(o(-124,0)),it.setScale(o(-1,1))}return it}else if(s==rt){if(!nt){const t=Ne();nt=new Yt(t.getCollection()),nt.setPos(o(0,0)),nt.translate(o(-83,0)),nt.setScale(o(-1,1))}return nt}else return null}function je(s){switch(s){case rt:return En;case V:return Tn;default:return null}}const m="M1,0.3C3.2,5.6 17.3,3.6 18.4,0.2C19.6,-3.1 17.3,104.1 18.4,120C19.1,130 -1,129.7 0,120C2.1,100.3 -1.4,-5.8 1,0.3Z",On="M37,11C34,-4 1,-4 0.32,14.C0.13,19 -0.3,50 0.3,65C1,80 35,80 37,67C39,49 38,17 37,11Z",he="M18,5.6C20,5 20,1 18,0.6C15,-0.2 4,-0.2 1,0.6C-0.4,1 -0.4,5 1.2,5.6C4,6.5 15,6.4 18,5.6Z",An="M0.124,70.026C29.523,40.841 28.681,-1.201 60.124,0.026C91.567,1.254 101.836,56.037 122.124,71.026C119.227,72.678 106.066,84.55 97.854,65.962C89.455,46.953 84.082,43.195 60.038,53.649C35.464,40.897 29.549,51.27 25.354,61.02C13.743,88.007 -1.532,71.67 0.124,70.026Z",Fn="M8.516,46.127C-8.011,46.639 18.468,41.553 0.516,13.127C-4,5.975 21.454,-16.772 63.516,22.127C76.897,34.501 22.499,-1.356 46.277,22.398C73.644,49.739 26.612,13.41 20.516,20.127C5.366,36.818 23.459,45.663 8.516,46.127Z",Ln="M10.539,262.888C9.062,262.418 0.055,224.755 0,209.69C8.941,202.46 4.975,2.61 10.693,0C17.446,2.677 11.559,198.873 20.326,210.443C19.074,229.045 11.667,263.247 10.539,262.888Z",Wn="M0.075,3.492C1.186,12.888 14.821,50.097 20.964,50.084C28.185,50.069 41.436,12.888 42.547,3.492C44.029,-9.038 22.956,16.183 21.311,16.183C19.666,16.183 -1.407,-9.038 0.075,3.492Z",jn="M43.841,0C22.867,-0.037 -15.822,37.041 6.954,108.153C15.316,134.263 21.082,22.471 48.609,142.281C53.565,163.85 74.491,116.822 61.658,69.258C57.365,53.347 71.878,55.842 74.707,75.03C79.928,110.449 103.709,0.105 43.841,0Z";function L(s,t,e){return e=Math.max(0,Math.min(1,e)),s+e*(t-s)}function te(s,t,e,n){let i=0;s.forEach(l=>l.setPos(o(t.x,t.y)));const r=()=>{i+=B;const l=i/n,c=L(t.x,e.x,l),h=L(t.y,e.y,l);s.forEach(g=>g.setPos(o(c,h))),i>=n&&U("tick",r)};T("tick",r)}function ee(s,t,e,n,i=!1){let r=0,l=1;s.forEach(h=>h.rotateSvg(t));const c=()=>{r+=B*l;const h=r/n,g=L(t,e,h);(!s||!s.length)&&U("tick",c),(r>=n||r<=0)&&(i?l=l*-1:U("tick",c)),s.forEach(u=>{if(u)u.rotateSvg(g,u.getCenterPos());else{U("tick",c);return}})};T("tick",c)}function Gn(s=o(0,0)){const t=s.x,e=new f(m,null,"r",y,o(0,0));e.rotateSvg(10),e.rotateSvg(10),e.rotateSvg(10),e.rotateSvg(10),e.rotateSvg(5),e.translateSvg(o(140+t,100));const n=new f(m,null,"r",y,o(0,0));n.rotateSvg(-10),n.rotateSvg(-10),n.rotateSvg(-10),n.rotateSvg(-10),n.rotateSvg(-5),n.translateSvg(o(50+t,160));const i=new f(m,null,"r",y,o(0,0));return i.rotateSvg(10),i.rotateSvg(10),i.rotateSvg(10),i.rotateSvg(10),i.rotateSvg(5),i.translateSvg(o(140+t,190)),[e,n,i]}function Ge(s=o(0,0)){const t=s.x,e=new f(m,null,"r",y,o(0,0));e.rotateSvg(10),e.rotateSvg(10),e.translateSvg(o(220+t,150));const n=new f(m,null,"r",y,o(0,0));n.rotateSvg(-10),n.rotateSvg(-10),n.translateSvg(o(230+t,160));const i=new f(m,null,"r",y,o(0,0));for(let r=0;r<8;r++)i.rotateSvg(10);return i.rotateSvg(5),i.translateSvg(o(290+t,200)),[e,n,i]}function Rn(s=o(0,0)){const t=s.x,e=new f(m,null,"r",y,o(0,0));e.translateSvg(o(320+t,150));const n=new f(m,null,"r",y,o(0,0));n.rotateSvg(-10),n.rotateSvg(-10),n.rotateSvg(-5),n.translateSvg(o(330+t,150));const i=new f(m,null,"r",y,o(0,0));i.rotateSvg(10),i.rotateSvg(10),i.rotateSvg(5),i.translateSvg(o(430+t,150));const r=new f(m,null,"r",y,o(0,0));return r.translateSvg(o(435+t,150)),[e,n,i,r]}function Re(){const s=new f(m,null,"r",y,o(0,0)),t=new f(m,null,"r",y,o(0,0)),e=new f(m,null,"r",y,o(0,0));for(let n=0;n<5;n++)t.rotateSvg(-10),e.rotateSvg(10);return t.translateSvg(o(-20,-5)),e.translateSvg(o(70,20)),[s,t,e]}function Nt(){const s=new f(m,null,"r",y,o(0,0)),t=new f(m,null,"r",y,o(0,0));for(let e=0;e<17;e++)t.rotateSvg(5);return t.translateSvg(o(100,100)),[s,t]}function qe(){const s=new f(m,null,"r",y,o(0,0)),t=new f(m,null,"r",y,o(0,0));for(let e=0;e<3;e++)s.rotateSvg(10),t.rotateSvg(-10);return t.translateSvg(o(-75,-20)),[s,t]}function qn(){const s=He(),t=new f(m,null,"r",y,o(0,0));for(let e=0;e<8;e++)t.rotateSvg(-5);return t.translateSvg(o(27,70)),[...s,t]}function He(){const s=_t(),t=new f(m,null,"r",y,o(0,0));for(let e=0;e<17;e++)t.rotateSvg(5);return t.translateSvg(o(100,0)),[...s,t]}function ue(){return[new f(m,null,"r",y,o(0,0))]}function Hn(){const s=Nt(),t=new f(m,null,"r",y,o(0,0)),e=new f(m,null,"r",y,o(0,0));for(let n=0;n<17;n++)e.rotateSvg(5);return t.translateSvg(o(80,30)),e.translateSvg(o(150,50)),[...s,t,e]}function _n(){const s=new f(m,null,"r",y,o(0,0)),t=new f(m,null,"r",y,o(0,0)),e=new f(m,null,"r",y,o(0,0));return t.rotateSvg(-10),t.rotateSvg(-10),t.rotateSvg(-5),t.translateSvg(o(10,10)),e.translateSvg(o(60,0)),[s,e,t]}function _e(){const s=new f(m,null,"r",y,o(0,0)),t=new f(m,null,"r",y,o(0,0)),e=new f(m,null,"r",y,o(0,0)),n=new f(m,null,"r",y,o(0,0));for(let i=0;i<17;i++)t.rotateSvg(5),e.rotateSvg(5),n.rotateSvg(5);return t.translateSvg(o(100,10)),e.translateSvg(o(100,50)),n.translateSvg(o(100,100)),[s,t,e,n]}function ze(){return[new f(m,null,"r",y,o(0,0)),...Ue()]}function Ue(){const s=new f(m,null,"r",y,o(0,0)),t=new f(m,null,"r",y,o(0,0)),e=new f(m,null,"r",y,o(0,0)),n=new f(m,null,"r",y,o(0,0));for(let i=0;i<5;i++)t.rotateSvg(10),n.rotateSvg(10);t.translateSvg(o(90,0)),n.translateSvg(o(90,60));for(let i=0;i<17;i++)s.rotateSvg(5),e.rotateSvg(5);return s.translateSvg(o(100,-10)),e.translateSvg(o(100,50)),[s,t,e,n]}function _t(){const s=new f(m,null,"r",y,o(0,0)),[t,e]=Nt();return s.translateSvg(o(65,0)),[t,e,s]}function zn(){const s=new f(m,null,"r",y,o(0,0));s.translateSvg(o(0,0));const t=new f(m,null,"r",y,o(0,0));t.rotateSvg(-10),t.rotateSvg(-10),t.rotateSvg(-5),t.translateSvg(o(40,20));const e=new f(m,null,"r",y,o(0,0));e.rotateSvg(10),e.rotateSvg(10),e.rotateSvg(5),e.translateSvg(o(50,20));const n=new f(m,null,"r",y,o(0,0));return n.translateSvg(o(95,0)),[s,t,e,n]}function se(){const s=Re(),t=Nt(),e=Ge(),n=qe();t.forEach(r=>r.translateSvg(o(100,0))),e.forEach(r=>r.translateSvg(o(30,-140))),n.forEach(r=>r.translateSvg(o(390,20)));const i=[...s,...t,...e,...n];return i.forEach(r=>{r.setScale(.5),r.setGravityScale(0)}),te(i,o(d.x/2-90,d.y),o(d.x/2-90,700),1),ee(i,-.05,.05,1,!0),i}function $e(){const s=zn();s.forEach(r=>{r.setScale(.25),r.translateSvg(o(30,0))});const t=_e(),e=ze(),n=Ue();t.forEach(r=>{r.setScale(.25),r.translateSvg(o(70,0))}),e.forEach(r=>{r.setScale(.25),r.translateSvg(o(100,0))}),n.forEach(r=>{r.setScale(.25),r.translateSvg(o(150,0))});const i=[...s,...t,...e,...n];return i.forEach(r=>r.setGravityScale(0)),te(i,o(d.x/2-100,d.y),o(d.x/2-100,d.y-100),1),ee(i,-.1,.1,1.3,!0),i}const Ke="sam-";let ct=0,Ze=Xe();function Xe(){const s=localStorage.getItem(`${Ke}highscore`);return s?parseFloat(s):0}function Un(s){ct=s}function $n(s=0){Ze=s,localStorage.setItem(`${Ke}highscore`,""+s)}function Kn(){return ct}function de(s,t){let e=10;switch(s.gameObjectType){case"f":e=45;break;case"a":e=5;break;case"l":e=15;break;case"h":e=20;break;case"ht":e=25;break;default:e=10}Zn(s,t,e)}function Zn(s,t,e){const n=o(35,55),i=1;let r=0,l=t.copy();const c=()=>{r+=B;const h=r/i,g=L(l.x,n.x,h),u=L(l.y,n.y,h);E.save();const p=L(48,10,h);E.font=`${p}px serif`,E.fillStyle=s.fill||"white",E.fillText(e,g,u),E.restore(),r>=i&&(ct+=e,ct>Ze&&$n(ct),U("tick",c))};T("tick",c)}class Xn{constructor(t){a(this,"cross",[]);a(this,"playButton",[]);a(this,"web3Button",[]);a(this,"isEventInProgress",!1);a(this,"killedMsg","");a(this,"onKilled",t=>{const e=t.detail.data.msg;this.killedMsg=e});a(this,"onSplit",t=>{if(this.sceneManager.currentScene!="g")return;const e=t.detail.data.svg;this.playButton.forEach(n=>{this.isEventInProgress||n==e&&(this.isEventInProgress=!0,A("play"))}),this.web3Button.forEach(n=>{this.isEventInProgress||n==e&&(this.isEventInProgress=!0,A("web3"))})});this.sceneManager=t,T("split",this.onSplit),T("killed",this.onKilled)}update(){this.cross.forEach(t=>{t.update(),C(t,2)}),this.playButton.forEach(t=>{t.update(),C(t,1)}),this.web3Button.forEach(t=>{t.update(),C(t,1)})}render(t){t.save(),t.shadowColor="black",t.shadowBlur=5,this.cross.forEach(e=>e.render(t)),this.playButton.forEach(e=>e.render(t)),this.web3Button.forEach(e=>e.render(t)),this.renderHighScore(t),this.renderKilledMsg(t),t.restore()}renderKilledMsg(t){t.font="28px serif",t.fillStyle="white",t.textAlign="center",t.fillText(this.killedMsg,d.x/2,400)}renderHighScore(t){const e=Xe();t.font="32px serif",t.fillStyle="white",t.textAlign="center",t.fillText(`Highscore: ${e}`,d.x/2,200)}start(){this.isEventInProgress=!1,this.playButton.length=0,this.web3Button.length=0,this.cross.length=0;const t=new f(m,null,null,y),e=new f(m,null,null,y);t.setGravityScale(0),e.setGravityScale(0);for(let n=0;n<8;n++)t.rotateSvg(5),e.rotateSvg(-5);t.translateSvg(o(80,-15)),this.cross.push(t,e),this.cross.forEach(n=>n.translateSvg(o(d.x/2-40,50))),this.playButton=se(),this.web3Button=$e()}}class fe{constructor(t=o(0,0),e=o(0,-1)){a(this,"arrowFlameSvg",new f(jn,null,null,Ot,o(0,180)));a(this,"arrowSvg",new f(Ln,null,null,"white",o(30,14)));a(this,"arrowFeatherSvg",new f(Wn,null,null,Ot,o(20,0)));a(this,"maxTipX");a(this,"minTipX");a(this,"ellapsedTime",0);a(this,"snapSound");a(this,"miniSliceSound");a(this,"killedTime",0);a(this,"onSplitArrow",t=>{t.detail.data.svg==this.arrowSvg&&(this.snapSound.play(),U("split",this.onSplitArrow))});a(this,"onSplitFeather",t=>{t.detail.data.svg==this.arrowFeatherSvg&&(this.miniSliceSound.play(),U("split",this.onSplitFeather))});this.arrowFeatherSvg.setGameObjectType("f"),this.arrowSvg.setGameObjectType("a"),this.getSvgs().forEach(n=>{n.setPos(o(n.pos.x+t.x,n.pos.y+t.y)),n.setScale(.5),n.setGravityScale(0),n.velocity=e}),this.snapSound=new at(Ls),this.miniSliceSound=new at(As),this.minTipX=this.arrowFlameSvg.cmds[2].x-2,this.maxTipX=this.arrowFlameSvg.cmds[2].x+2,T("split",this.onSplitArrow),T("split",this.onSplitFeather)}getPos(){return this.arrowSvg.pos}isCut(){return this.arrowSvg.isCut()}render(t){this.getSvgs().forEach(e=>e.render(t))}update(){if(this.getSvgs().forEach(t=>t.update()),this.arrowFeatherSvg.isCut()&&(this.arrowFeatherSvg.children[0].fill=Ot,this.arrowFeatherSvg.children[1].fill=Is,this.arrowFeatherSvg.children[0].velocity.x=2,this.arrowFeatherSvg.children[1].velocity.x=-2,this.arrowFeatherSvg.children[0].setGravityScale(15),this.arrowFeatherSvg.children[1].setGravityScale(10)),this.arrowSvg.isCut()){this.killedTime+=B,this.arrowFlameSvg.setScale(.93),this.arrowFlameSvg.setPos(o(this.arrowFlameSvg.pos.x+5,this.arrowFlameSvg.pos.y+16));const t=this.arrowSvg.children[0],e=this.arrowSvg.children[1];t.setPos(o(t.pos.x-1,t.pos.y-2)),e.setPos(o(e.pos.x+1,e.pos.y-2)),e.rotateSvg(3),t.rotateSvg(-3),e.setScale(.95),t.setScale(.95)}this.updateFlameAnim(),C(this.arrowFeatherSvg,3),C(this.arrowSvg,.1),this.arrowSvg.isCut()||Math.abs(this.arrowSvg.pos.y)>=d.y+400&&A("killed",{msg:"Sam took an arrow in the knee"})}updateFlameAnim(){this.ellapsedTime+=B}debugPoint(t,e){t.save(),t.fillStyle="green",t.moveTo(e.x,e.y),t.arc(e.x,e.y,5,0,2*Math.PI),t.fill(),t.restore()}getSvgs(){return[this.arrowFeatherSvg,this.arrowSvg,this.arrowFlameSvg]}}function j(s){switch(s){case"r":return y;case"b":return qt}}function Yn(s){switch(s){case"r":return Ts;case"b":return ks}}class Wt{constructor(t=o(0,d.y),e,n=o(1,0),i=!1){a(this,"svgBody");a(this,"svgTipTop");a(this,"svgTipBot");a(this,"gradient");a(this,"centerPos",o(0,0));a(this,"pos",o(0,0));a(this,"velocity",o(0,0));a(this,"gravitationScale",-1.4);a(this,"sliceColor");a(this,"shouldRotate",!1);a(this,"killedTime",0);this.shouldRotate=i,this.sliceColor=e,this.svgBody=new f(On,null,e,j(e),o(t.x,t.y),o(0,0),o(39,77)),this.svgBody.setGameObjectType("l"),this.svgTipTop=new f(he,null,null,"black",o(t.x+9,t.y-4),o(0,0),o(20,6)),this.svgTipBot=new f(he,null,null,"black",o(t.x+9,t.y+74),o(0,0),o(20,6)),this.centerPos=o(t.x+19,t.y+40),this.velocity=n,this.getSvgs().forEach(r=>{r.setGravityScale(0)}),this.pos=o(0,0)}getSvgs(){return[this.svgBody,this.svgTipTop,this.svgTipBot]}isCut(){return this.svgBody.isCut()}update(){if(this.svgBody.isCut()){this.killedTime+=B,this.svgTipTop.setGravityScale(27),this.svgTipBot.setGravityScale(22),this.svgTipBot.rotateSvg(-.1,this.svgTipBot.getCenterPos()),this.svgTipTop.rotateSvg(.1,this.svgTipTop.getCenterPos()),this.svgBody.velocity.x=this.velocity.x,this.svgTipTop.velocity.x=this.velocity.x,this.svgTipBot.velocity.x=this.velocity.x;return}const t=this.getCenterPos();this.velocity.y-=ht*this.gravitationScale*xe(),this.pos.x+=this.velocity.x,this.pos.y+=this.velocity.y,this.getSvgs().forEach(e=>{this.shouldRotate&&e.rotateSvg(-1,o(t.x,t.y)),e.update(o(-this.velocity.x,-this.velocity.y))}),C(this.svgBody)}render(t){t.save(),t.shadowBlur=0,this.getSvgs().forEach(e=>e.render(t)),this.gradient=Tt.createRadialGradient(d.x/2,d.y/2,0,-100,-100,d.y),this.gradient.addColorStop(0,j(this.sliceColor)),this.gradient.addColorStop(.5,Yn(this.sliceColor)),this.gradient.addColorStop(1,j(this.sliceColor)),this.svgBody.fill=this.gradient,t.restore()}debugCenterPoint(t){t.save(),t.fillStyle="green";const e=this.centerPos.x+this.pos.x,n=this.centerPos.y+this.pos.y;t.moveTo(e,n),t.arc(e,n,5,0,2*Math.PI),t.fill(),t.restore()}getCenterPos(){const t=this.centerPos.x+this.pos.x,e=this.centerPos.y+this.pos.y;return o(t,e)}}class Qn{constructor(t){a(this,"arrows",[]);a(this,"lanterns",[]);a(this,"bamboos",[]);a(this,"music");a(this,"ellapsedPlayTime",0);a(this,"bpm",120);a(this,"bps",this.bpm/60);a(this,"currentColorToSlice","r");a(this,"nextColorToSlice","b");a(this,"maxColorSize",6);a(this,"currentWave",0);a(this,"sliceColorMaxLifeTime",7);a(this,"currentSliceColorEllapseTime",0);a(this,"waveDuration",7);a(this,"currentWaveEllapseTime",0);a(this,"helm");a(this,"helmTop");a(this,"onSplit",t=>{if(this.sceneManager.currentScene!="l")return;const e=t.detail.data.svg,n=t.detail.data.intersectionPoint,i=e.sliceColor;if(!i){de(e,n);return}i==this.currentColorToSlice?de(e,n):A("killed",{msg:"Sam, you cut the wrong color"})});a(this,"onNewWave",t=>{if(this.removeUnusedObjects(),this.sceneManager.currentScene=="l"){if(this.currentWave==1)for(let e=0;e<2;e++)this.lanterns.push(new Wt(o(600+e*146,d.y+200),"b",o(-1,0)));if(this.currentWave==2&&this.arrows.push(new fe(o(d.x/2,-300),o(0,-1))),this.currentWave==3||this.currentWave==4)for(let e=0;e<2;e++){const n=e?"r":"b";let i=70+Math.random()*(d.x/2-140);e&&(i=70+d.x/2+Math.random()*(d.x/2-200));const r=new f(m,null,n,j(n));r.setScale(2),r.translateSvg(o(i,-300)),this.bamboos.push(r)}if(this.currentWave%5==0){let e=Math.max(-3.5,this.currentWave/5*-1);for(let n=0;n<3;n++){const i=200+n*210+Math.random()*70,r=-300+n*(Math.random()*20);this.arrows.push(new fe(o(i,r),o(0,e)))}}if(this.currentWave==6&&(this.spawnLanterns(),this.spawnBamboos(),this.waveDuration=6),this.currentWave>=7){if(this.waveDuration=5,this.currentWave%2==0){const e=this.getRandomSliceColor();let n=70+Math.random()*(d.x-200);const i=new f(m,null,e,j(e));i.setScale(2),i.translateSvg(o(n,-200)),this.bamboos.push(i)}this.currentWave%3==0&&(this.spawnLanterns(),this.createHelm(this.currentColorToSlice)),(this.currentWave+1)%4==0&&(this.currentWave>=15?this.spawnBamboos(5):this.spawnBamboos(4))}this.currentWave==15&&(this.sliceColorMaxLifeTime=4),this.currentWave==25&&(this.sliceColorMaxLifeTime=3),this.currentWave==35&&(this.sliceColorMaxLifeTime=2),this.currentWave==50&&(this.sliceColorMaxLifeTime=1.5),this.currentWave==75&&(this.sliceColorMaxLifeTime=1)}});this.sceneManager=t,this.music=t.levelMusic,T("split",this.onSplit),T("wave",this.onNewWave)}createHelm(t){const e=Math.random()*300,n=o(H(.5,1.5)*-1,0);let i=-350;e>=150&&(i=d.x+350,n.x*=-1);const r=H(d.y/2+300,d.y/2-300);this.helm=new f(An,null,t,j(t),o(i,r),n,o(0,0),0),this.helmTop=new f(Fn,null,t,j(t),o(i+50,r-40),n,o(0,0),0),this.helm.gameObjectType="h",this.helmTop.gameObjectType="ht"}update(){this.arrows.forEach(t=>t.update()),this.lanterns.forEach(t=>t.update()),this.bamboos.forEach(t=>{t.update(),C(t)}),this.ellapsedPlayTime+=B,this.helm&&(this.helm.update(),C(this.helm)),this.helmTop&&(this.helmTop.update(),C(this.helmTop)),this.updateColorToSlice(),this.handleWaves()}render(t){this.arrows.forEach(e=>e.render(t)),this.lanterns.forEach(e=>e.render(t)),this.bamboos.forEach(e=>e.render(t)),this.helm&&this.helm.render(t),this.helmTop&&this.helmTop.render(t),this.renderTutorial(t),this.animateColorsToSliceBar(t)}updateColorToSlice(){this.ellapsedPlayTime!=0&&(this.currentSliceColorEllapseTime+=B,this.currentSliceColorEllapseTime>=this.sliceColorMaxLifeTime&&(this.currentSliceColorEllapseTime=0,this.currentColorToSlice=this.nextColorToSlice,this.nextColorToSlice=this.getRandomSliceColor(),A("toslice",{colorToSlice:this.currentColorToSlice})))}handleWaves(){this.currentWaveEllapseTime+=B,this.currentWaveEllapseTime>=this.waveDuration&&(this.currentWaveEllapseTime=0,A("wave",{wave:++this.currentWave}))}animateColorsToSliceBar(t){t.beginPath(),t.fillStyle=j(this.currentColorToSlice);let e=o(d.x/2,50);const n=L(10,5,.5+Math.sin(this.ellapsedPlayTime*3)/2);let i=6,r=0;t.moveTo(e.x,e.y),t.arc(e.x,e.y,i+n,0,Math.PI*2,!1),t.arc(e.x,e.y,r,0,Math.PI*2,!0),t.fill(),t.closePath(),t.restore(),t.beginPath(),t.fillStyle=j(this.nextColorToSlice);const l=this.currentSliceColorEllapseTime,c=L(0,d.x/2,l/this.sliceColorMaxLifeTime);e=o(d.x-c,50),i=1,r=n/1.5,t.moveTo(e.x,e.y),t.arc(e.x,e.y,i+n,0,Math.PI*2,!1),t.arc(e.x,e.y,r,0,Math.PI*2,!0),t.fill(),t.closePath(),t.restore()}renderColorToScliceCircle(t,e,n,i=!1){switch(t.save(),e){case"r":t.fillStyle=y;break;case"b":t.fillStyle=qt;break}t.beginPath();const r=L(10,5,.5+Math.sin(this.ellapsedPlayTime*3)/2),l=i?6:1,c=i?0:r/1.5;t.moveTo(n.x,n.y),t.arc(n.x,n.y,l+r,0,Math.PI*2,!1),t.arc(n.x,n.y,c,0,Math.PI*2,!0),t.fill(),t.closePath(),t.restore()}start(){Un(0),this.currentColorToSlice="r",this.nextColorToSlice="b",this.lanterns.length=0,this.bamboos.length=0,this.arrows.length=0;for(let t=0;t<2;t++)this.lanterns.push(new Wt(o(t*146,d.y-100),"r"));this.ellapsedPlayTime=0,this.currentWave=0,this.currentSliceColorEllapseTime=0,this.currentWaveEllapseTime=0,this.waveDuration=7,this.sliceColorMaxLifeTime=7,A("toslice",{colorToSlice:this.currentColorToSlice}),this.music.stop(),this.music.play()}getRandomSliceColor(){switch(Math.floor(Math.random()*2)){case 0:return"r";case 1:return"b";default:return"r"}}spawnBamboos(t=4){for(let e=0;e<t;e++){let n=this.getRandomSliceColor();setTimeout(i=>{let r=70+e*150+Math.random()*50;const l=new f(m,null,i,j(i));l.setScale(1.25),l.translateSvg(o(r,-200)),this.bamboos.push(l)},e*100,n)}}spawnLanterns(){for(let t=0;t<4;t++){const e=new Wt(o(50+t*220,d.y),this.getRandomSliceColor());e.centerPos.x>=d.x/2+200?e.velocity=o(H(.2,1)*-1,H(0,.2)):e.velocity=o(H(.2,1),H(0,.2)),e.shouldRotate=!0,this.lanterns.push(e)}}removeUnusedObjects(){for(let t=this.bamboos.length-1;t>=0;t--){const e=this.bamboos[t];(Math.abs(e.pos.y)>d.y+1e3||e.isCut()&&e.killedTime>=5)&&this.bamboos.splice(t,1)}for(let t=this.lanterns.length-1;t>=0;t--){const e=this.lanterns[t];(Math.abs(e.getCenterPos().y)>=d.y+1e3||e.isCut()&&e.killedTime>=5)&&this.lanterns.splice(t,1)}for(let t=this.arrows.length-1;t>=0;t--){const e=this.arrows[t];(Math.abs(e.getPos().y)>d.y+1e3||e.isCut()&&e.killedTime>=5)&&this.arrows.splice(t,1)}this.helm&&(Math.abs(this.helm.pos.x)>d.x+2e3||this.helm.killedTime>=5)&&(this.helm=null),this.helmTop&&(Math.abs(this.helmTop.pos.x)>d.x+2e3||this.helmTop.killedTime>=5)&&(this.helmTop=null)}renderTutorial(t){t.save(),t.font="28px serif",t.fillStyle="white",t.textAlign="center",t.lineWidth=5,t.lineCap="round",t.moveTo(d.x/2,350),t.lineTo(d.x/2,75),t.moveTo(d.x/2,75),t.lineTo(d.x/2+10,90),t.moveTo(d.x/2,75),t.lineTo(d.x/2-10,90);const e="Only slice same color";this.currentWave==0?(t.fillText(`${e} (now red)`,d.x/2,400),t.strokeStyle=y,t.stroke()):this.currentWave==1?(t.fillText(`${e} (now blue)`,d.x/2,400),t.strokeStyle=qt,t.stroke()):this.currentWave==2&&t.fillText("WARNING. Slice arrow or die",d.x/2,400),t.restore()}}class Jn{constructor(t){a(this,"letters",[]);a(this,"playButton",[]);a(this,"web3Button",[]);a(this,"ellapsedTime",0);a(this,"music");a(this,"isChangingScene",!1);a(this,"hasInteracted",!1);a(this,"onSplit",t=>{if(this.sceneManager.currentScene!="m")return;const e=t.detail.data.svg;this.playButton.forEach(n=>{n==e&&(this.isChangingScene=!0,this.music.stop(),A("play"))}),this.web3Button.forEach(n=>{n==e&&(this.isChangingScene=!0,this.music.stop(),A("web3"))})});a(this,"helpEllapsedTime",0);a(this,"helpDuration",1);this.sceneManager=t,this.createTitle(),this.playButton=se(),this.web3Button=$e(),this.music=this.sceneManager.mainMenuMusic,T("split",this.onSplit),this.listenForInteractive()}listenForInteractive(){const t=()=>{this.hasInteracted||(this.hasInteracted=!0)};document.addEventListener("touchstart",t),document.addEventListener("mousedown",t)}createTitle(){const t=o(62,0),e=Gn(t),n=Ge(t),i=Rn(t);this.letters.push(...e),this.letters.push(...n),this.letters.push(...i),this.letters.forEach(r=>r.setGravityScale(0)),ee(this.letters,-.1,.1,2,!0)}update(){this.ellapsedTime+=B,this.letters.forEach(t=>C(t)),this.playButton.forEach(t=>C(t,1)),this.web3Button.forEach(t=>C(t,1))}render(t){t.save(),t.shadowColor="black",t.shadowBlur=5,this.letters.forEach(e=>e.render(t)),this.playButton.forEach(e=>e.render(t)),this.web3Button.forEach(e=>e.render(t)),t.restore(),this.renderSliceHelp(t)}renderSliceHelp(t){if(!this.hasInteracted||(this.helpEllapsedTime=(this.helpEllapsedTime+B)%(this.helpDuration*2),this.helpEllapsedTime>=1.1))return;const e=o(d.x/2-150,800),n=o(d.x/2+150,700),i=L(e.x,n.x,this.helpEllapsedTime/this.helpDuration),r=L(e.y,n.y,this.helpEllapsedTime/this.helpDuration);t.save(),t.font="42px serif",t.shadowColor="black",t.fillText("",i,r),t.restore()}}class Vn{constructor(t){a(this,"lightSaber");a(this,"haloSaber");a(this,"playBtn",[]);a(this,"loginBtn",[]);a(this,"equipHaloSaberBtn",[]);a(this,"equipLightSaberBtn",[]);a(this,"buyLightSaberBtn",[]);a(this,"buyHaloSaberBtn",[]);a(this,"isEventInProgress",!1);a(this,"equipButton",[]);a(this,"onSplit",t=>{if(this.sceneManager.currentScene!="w")return;const e=t.detail.data.svg;this.playBtn.forEach(n=>{this.isEventInProgress||n==e&&(this.isEventInProgress=!0,le(!1),A("play"))}),this.lightSaber&&this.lightSaber.getSvgs().forEach(n=>{n==e&&pt(rt)}),this.haloSaber&&this.haloSaber.getSvgs().forEach(n=>{n==e&&pt(V)}),this.loginBtn.forEach(n=>{this.isEventInProgress||n==e&&Ft()!=!1&&(this.isEventInProgress=!0)}),this.equipLightSaberBtn.forEach(n=>{n==e&&(pt(rt),ce(rt))}),this.equipHaloSaberBtn.forEach(n=>{n==e&&(pt(V),ce(V))}),this.buyLightSaberBtn.forEach(n=>{this.isEventInProgress||n==e&&(q()?(ae(bt),this.isEventInProgress=!0):Ft()!=!1&&(this.isEventInProgress=!0))}),this.buyHaloSaberBtn.forEach(n=>{this.isEventInProgress||n==e&&(this.isEventInProgress=!0,q()?ae(Ct):Ft())})});this.sceneManager=t,T("split",this.onSplit)}createLoginButton(){const t=Nt(),e=He(),n=Hn(),i=ue(),r=_n();return e.forEach(l=>l.translateSvg(o(120,0))),n.forEach(l=>l.translateSvg(o(255,0))),i.forEach(l=>l.translateSvg(o(420,0))),r.forEach(l=>l.translateSvg(o(470,0))),[...t,...e,...n,...i,...r]}createEquipButton(){const t=_e(),e=qn(),n=_t(),i=ue(),r=Re();return e.forEach(l=>l.translateSvg(o(120,0))),n.forEach(l=>l.translateSvg(o(255,0))),i.forEach(l=>l.translateSvg(o(400,0))),r.forEach(l=>l.translateSvg(o(450,0))),[...t,...e,...n,...i,...r]}createBuyButton(){const t=ze(),e=_t(),n=qe();return e.forEach(i=>i.translateSvg(o(120,0))),n.forEach(i=>i.translateSvg(o(310,15))),[...t,...e,...n]}async initWeapons(){await Promise.all([xn()]),this.lightSaber=Ne(),this.haloSaber=Be(),this.lightSaber=new Yt(this.lightSaber.collection),this.haloSaber=new Qt(this.haloSaber.collection)}update(){this.lightSaber&&this.lightSaber.update(),this.haloSaber&&this.haloSaber.update(),q()&&mt(bt)?this.equipLightSaberBtn.forEach(t=>{t.update(),C(t,1)}):Lt()&&this.buyLightSaberBtn.forEach(t=>{t.update(),C(t,1)}),q()&&mt(Ct)?this.equipHaloSaberBtn.forEach(t=>{t.update(),C(t,1)}):Lt()&&this.buyHaloSaberBtn.forEach(t=>{t.update(),C(t,1)}),this.playBtn.forEach(t=>{t.update(),C(t,2)}),Lt()&&!q()&&this.loginBtn.forEach(t=>{t.update(),C(t,1)})}render(t){this.lightSaber&&this.lightSaber.render(t),this.haloSaber&&this.haloSaber.render(t),t.save(),t.shadowColor="black",t.shadowBlur=5,q()&&mt(bt)?this.equipLightSaberBtn.forEach(e=>e.render(t)):this.buyLightSaberBtn.forEach(e=>e.render(t)),q()&&mt(Ct)?this.equipHaloSaberBtn.forEach(e=>e.render(t)):this.buyHaloSaberBtn.forEach(e=>e.render(t)),this.playBtn.forEach(e=>e.render(t)),q()||this.loginBtn.forEach(e=>e.render(t)),t.restore()}start(){this.playBtn.length=0,this.buyLightSaberBtn.length=0,this.buyHaloSaberBtn.length=0,this.loginBtn.length=0,this.equipHaloSaberBtn.length=0,this.equipLightSaberBtn.length=0,this.playBtn=se(),this.buyLightSaberBtn=this.createBuyButton(),this.buyHaloSaberBtn=this.createBuyButton(),this.loginBtn=this.createLoginButton(),this.equipHaloSaberBtn=this.createEquipButton(),this.equipLightSaberBtn=this.createEquipButton(),this.buyLightSaberBtn.forEach(t=>{t.setScale(.25),t.setGravityScale(0),t.translateSvg(o(375,500))}),this.buyHaloSaberBtn.forEach(t=>{t.setScale(.25),t.setGravityScale(0),t.translateSvg(o(150,500))}),this.equipHaloSaberBtn.forEach(t=>{t.setGravityScale(0),t.setScale(.25),t.translateSvg(o(150,500))}),this.equipLightSaberBtn.forEach(t=>{t.setGravityScale(0),t.setScale(.25),t.translateSvg(o(375,500))}),this.loginBtn.forEach(t=>{t.setGravityScale(0),t.setScale(.25)}),te(this.loginBtn,o(d.x/2-70,d.y),o(d.x/2-70,d.y-100),1),this.isEventInProgress=!1,bn().then(async()=>{q()&&await Cn()}),le(!0),this.initWeapons()}}function ti(s=1.5,t,e){let n=0;const i=E;let r=1;const l=()=>{if(n+=B,n>=s){e(),U("tick",l);return}let c=0;r?c=400-n*1e3:c=n*1e3-600,c<=-400&&(t(),r=0),i.save(),i.fillStyle="#000",i.beginPath(),i.moveTo(d.x/2,d.y/2),i.arc(d.x/2,d.y/2,d.y,0,Math.PI*2,!1),i.arc(d.x/2,d.y/2,Math.max(0,c),0,Math.PI*2,!0),i.fill(),i.closePath(),i.restore()};T("tick",l)}class ei{constructor(){}render(){E.save();const t=Kn();E.font="32px serif",E.fillStyle="white",E.fillText(t,40,60),E.restore()}update(){}}class si{constructor(){}update(){}render(t){t.save(),t.font="32px serif",t.fillStyle="white",t.textAlign="center",t.fillText("Samurai Sam",d.x/2,d.y/2),t.fillText("Touch screen or click to start",d.x/2,d.y/2+100),t.restore()}}class ni{constructor(){a(this,"currentScene","i");a(this,"mainMenu");a(this,"level");a(this,"web3Scene");a(this,"gameOverScene");a(this,"introScene");a(this,"hud");a(this,"isChangingScenes",!1);a(this,"isOnKillProcedure",!1);a(this,"hasInteracted",!1);a(this,"killSound");a(this,"mainMenuMusic");a(this,"levelMusic");a(this,"onKilled",t=>{this.isChangingScenes||this.isOnKillProcedure||this.startOnKilledProcedure()});a(this,"onPlay",t=>{this.isChangingScenes||this.changeScene("l")});a(this,"onWeb3",t=>{this.isChangingScenes||this.changeScene("w")});this.killSound=new at(Fs),this.mainMenuMusic=new oe(qs),this.levelMusic=new oe(Hs),this.mainMenuMusic.loop=!0,this.levelMusic.loop=!0,this.introScene=new si,this.listenForInteractive(),T("play",this.onPlay),T("web3",this.onWeb3),T("killed",this.onKilled)}listenForInteractive(){const t=()=>{this.hasInteracted||(this.changeScene("m"),this.mainMenuMusic.play(),this.createScenes(),this.hasInteracted=!0)};document.addEventListener("touchstart",t),document.addEventListener("mousedown",t)}createScenes(){this.mainMenu=new Jn(this),this.level=new Qn(this),this.web3Scene=new Vn(this),this.gameOverScene=new Xn(this),this.hud=new ei}changeScene(t){this.isChangingScenes=!0,ti(1.5,()=>{this.currentScene=""},()=>{switch(this.currentScene=t,this.isChangingScenes=!1,t){case"l":return this.level.start();case"w":return this.web3Scene.start();case"g":return this.gameOverScene.start()}})}startOnKilledProcedure(){this.isOnKillProcedure=!0,this.killSound.play();const t=1.5;let e=0;const n=i=>{e+=B,e<=1?(E.fillStyle=`rgba(200, 200, 200, ${Math.min(.9,e)})`,E.moveTo(0,0),E.fillRect(0,0,d.x,d.y),Dt(.3)):(E.fillStyle=`rgba(200, 200, 200, ${Math.max(0,1.9-e)})`,E.moveTo(0,0),E.fillRect(0,0,d.x,d.y),Dt(Math.min(1,e-.8))),e>=1&&!this.isChangingScenes&&this.changeScene("g"),e>=t&&(this.isOnKillProcedure=!1,Dt(1),U("tick",n))};T("tick",n)}update(){switch(this.currentScene!=""&&this.currentScene!="m"&&this.currentScene!="w"&&this.currentScene!="i"&&this.hud.update(),this.currentScene){case"l":return this.level.update();case"m":return this.mainMenu.update();case"w":return this.web3Scene.update();case"g":return this.gameOverScene.update();case"i":return this.introScene.update()}}render(t){switch(this.currentScene!=""&&this.currentScene!="m"&&this.currentScene!="w"&&this.currentScene!="i"&&this.hud.render(),this.currentScene){case"l":return this.level.render(t);case"m":return this.mainMenu.render(t);case"w":return this.web3Scene.render(t);case"g":return this.gameOverScene.render(t);case"i":return this.introScene.render(t)}}}let jt=900;const ii=900,ri=20,oi=130,ge=15;let vt=15,zt;function ai(){T("toslice",t=>{zt=t.detail.data.colorToSlice})}function li(s){jt=(jt+B*vt)%ii,vt-=B*30,vt<=ge&&(vt=ge),s.save(),s.fillStyle=Bs,zt=="r"?s.fillStyle=Es:zt=="b"&&(s.fillStyle=Ns);for(let t=-10;t<ri;t++){const e=jt+t*oi;s.fillRect(-10,e,d.x+20,30)}s.restore()}ai();let ne;function ci(){Ps(-.01),xs(o(640,1136)),ne=new ni}function hi(){A("tick"),Dn(),ne.update()}function ui(){}function di(){const s=Tt;b.style.background=Ms,li(s),ne.render(s),In(s)}function fi(){}ws(ci,hi,ui,di,fi);
